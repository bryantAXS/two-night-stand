$(document).ready(function(){$(".edit_option").hide();$("#rotate_fieldset p").hide();$("#rotate_fieldset .icons").show();$("#showToolbarLink a").toggle(function(){$("#file_manager_tools").hide();$("#showToolbarLink a span").text(EE.lang.show_toolbar);$("#showToolbarLink").animate({marginRight:"20"});$("#file_manager_holder").animate({marginRight:"10"})},function(){$("#showToolbarLink a span").text(EE.lang.hide_toolbar);$("#showToolbarLink").animate({marginRight:"314"});$("#file_manager_holder").animate({marginRight:"300"},function(){$("#file_manager_tools").show()})});$("#file_manager_tools h3 a").toggle(function(){$(this).parent().next("div").slideUp();$(this).toggleClass("closed")},function(){$(this).parent().next("div").slideDown();$(this).toggleClass("closed")});$("#file_manager_list h3").toggle(function(){$(this).next().slideUp();$(this).toggleClass("closed")},function(){$(this).next().slideDown();$(this).toggleClass("closed")});function i(k){$("#crop_x").val(Math.floor(k.x));$("#crop_y").val(Math.floor(k.y));$("#crop_width").val(Math.floor(k.w));$("#crop_height").val(Math.floor(k.h))}function c(k){$(".edit_option").hide();if(k!=undefined){$("#"+k+"_fieldset").fadeIn()}$("#crop_x").val("");$("#crop_y").val("");$("#crop_width").val("");$("#crop_height").val("");$("#resize_width").val("");$("#resize_height").val("")}function h(k){if(k==undefined){$("#resize_width").val($("#edit_image").width());$("#resize_height").val($("#edit_image").height())}else{edit_mode=true;$("#resize_width").val(Math.floor(k.width));$("#resize_height").val(Math.floor(k.height))}}function a(l,m,k){$("#confirm").modal({close:false,overlayId:"confirmModalOverlay",containerId:"confirmModalContainer",onShow:function(n){n.data.find(".message").append(l);n.data.find(".yes").click(function(){if($.isFunction(m)){m.apply()}$.modal.close()});n.data.find(".no").click(function(){if($.isFunction(k)){k.apply()}$.modal.close()})}})}edit_mode=false;function f(k){if(edit_mode!=false){a("'.$this->lang->line('exit_apply_changes').'",function(){$("#edit_file_submit").click();return true},function(){e(k)})}else{e(k)}}function j(){c("resize");h();$("#edit_image").resizable({handles:"all",animate:true,ghost:true,aspectRatio:true,knobHandles:true,resize:function(l,k){h(k.size)}})}function e(l,k){if(k==undefined){k=[50,50,100,100]}$("#edit_image").resizable("destroy");$("#edit_image_holder").html('<img src="'+EE.filemanager.url_path+'" alt="" id="edit_image" />');if(l=="rotate"){c("rotate")}else{if(l=="resize"){setTimeout(j,250)}else{c("crop");$("#edit_image").Jcrop({setSelect:k,onChange:i,onSelect:function(){edit_mode=true}})}}}$("#rotate_fieldset li img").click(function(){$("#rotate").val($(this).attr("alt"));$("#edit_file_submit").attr("disabled",true).addClass("disabled_field");$("#image_edit_form").submit()},function(){$("#edit_file_submit").attr("disable","false").removeClass("disabled_field")});var g=$("#edit_image").height()/$("#edit_image").width();var b=$("#edit_image").width()/$("#edit_image").height();function d(m,l){var k=800;ratio=(l=="height")?b:g;result=Math.floor(ratio*m);return result}$("#crop_mode").click(function(){f("crop");return false});$("#resize_mode").click(function(){f("resize");return false});$(".crop_dim").keyup(function(){e("crop",[$("#crop_x").val(),$("#crop_y").val(),parseInt($("#crop_x").val())+parseInt($("#crop_width").val()),parseInt($("#crop_y").val())+parseInt($("#crop_height").val())])});$("#resize_width").keyup(function(){width=parseInt($("#resize_width").val());height=d(width,"width");$("#edit_image, .ui-wrapper").width(width);$("#edit_image, .ui-wrapper").height(height);$("#resize_height").val(height)});$("#resize_height").keyup(function(){height=parseInt($("#resize_height").val());width=d(height,"height");$("#edit_image, .ui-wrapper").width(width);$("#edit_image, .ui-wrapper").height(height);$("#resize_width").val(width)});$("#rotate_mode").click(function(){f("rotate");return false});$("#rotate").change(function(){edit_mode=true})});